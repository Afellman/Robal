<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Job Posts</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
  <link rel="stylesheet" href="./assets/css/style.css" />
  <link href="https://fonts.googleapis.com/css?family=Vollkorn+SC" rel="stylesheet">
</head>
<style>

  * {
    font-family: 'Vollkorn SC', serif;
  }


  .subtle {
    color: #656565;
  }

  #dashboard-container {
    
    padding: 20px 50px 20px 50px
  }

  .chat-card {
    padding: 10px;
  }

  #chat-submit {
    margin-left: 10px;
  }

  .inbox-message:hover {
    cursor: pointer;
  }
</style>
<body>
  <div class="content-wrapper">
    <div class="container  bg-light" id="dashboard-container">
      <div class="row">
        <h1 id="user-title">User</h1>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="card" style="width: 18rem;">
            <div class="card-body">
              <h4 class="card-title">Wallet</h4>
              <p id="wallet-amount" class="card-text d-inline-block">10</p><span class="d-inline"> Hours</span>
            </div>
          </div>
        </div>
        <div class="col-md-6">
            <div class="card" style="width: 18rem;">
              <div class="card-body">
                <h4 class="card-title text-center">Inbox</h4>
                <button class="btn btn-primary" data-toggle="modal" data-target="#inboxModal">Check Inbox</button>
              </div>
            </div>
          </div>
      </div>
      <div class="col-md-6">
      </div>
      <div class="row">
        <div class="col-md-6">
          blah
        </div>
        <div class="col-md-6">
          blah
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-lg-6">
          <div class="card chat-card">
            <div class="card-block">
              <h5 class="card-title mb-4">Chat about everything Robal!</h5>
              <form class="forms-sample">
                <div class="form-group">
                  <div id="chat-area">
                  </div>
                  <div class="d-flex" id="new-chat-div">
                    <input type='text' id='new-chat-box' class="form-control"/>
                    <button id="chat-submit" class="btn btn-primary">Submit</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
    <!-- Inbox Modal -->
    <div class="modal fade" id="inboxModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Inbox</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          
          <div class="modal-body">
              <p class="subtle">click to delete message</p>
            <ul id="inbox">
            </ul>
          </div>
          <div class="modal-footer">
            <button type="button" id="contact-btn" class="btn btn-primary" data-dismiss="modal">close</button>
          </div>
        </div>
      </div>
    </div>
  <script
  src="https://code.jquery.com/jquery-3.2.1.js"
  integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
  crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBzTLxC73DXyLzgblZUBKMdM4_LJgnKmKY&callback=initMap"
async defer></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>

  <script>
    			$(document).ready(function() {
				// Initialzing Firebase
				var config = {
					apiKey: "AIzaSyCRUos4srVsw2Gw6_ghM2YTUSXdm-L6kEo",
					authDomain: "robal-f2619.firebaseapp.com",
					databaseURL: "https://robal-f2619.firebaseio.com",
					projectId: "robal-f2619",
					storageBucket: "robal-f2619.appspot.com",
					messagingSenderId: "1011207778959"
				};
				firebase.initializeApp(config);
				
				// Storing Firebase in database
				var database = firebase.database();
				var postNumber;
        var jobAcceptMessages = [];
				// function to store snapshot data in an array
				function snapshotToArray(snapshot) {
					var returnArr = [];

					snapshot.forEach(function(childSnapshot) {
						var item = childSnapshot.val();
						item.key = childSnapshot.key;

						returnArr.push(item);
					});
					return returnArr;
				};

				// grabbing shapshot from firebase/chatbox/posts
				
        database.ref('/chatBox/posts').on('value', function(snapshot) {
            
					chatBoxArray = snapshotToArray(snapshot);
					console.log(chatBoxArray)
					postNumber = snapshot.postNumber;
                    $('#chat-area').empty();
					// running through the array of posts, storing each locally, 
					// then appending it to the dom
					for (var i = chatBoxArray.length - 1; i > chatBoxArray.length - 7; i --){
						var line = chatBoxArray[i];
						$('#chat-area').prepend('<p> - ' + line + '</p>');
					};
				});
				database.ref('/chatBox').on('value', function(snapshot) {
					postNumber = snapshot.val().postNumber;
				});
				$('#chat-submit').on('click', function(event) {
          event.preventDefault(); 
					var postText = $('#new-chat-box').val();
					database.ref('/chatBox/posts').push(postText)
          $('#new-chat-box').val("");
				});
			
        // Getting firebase snapshot for job accept messages and prepending 
        // to the #inbox div.
        database.ref('/jobAcceptMsg').on('value', function (snapshot) {
          var messages = snapshotToArray(snapshot);
          console.log(messages);
          messages.forEach(function(msg) {
            $('#inbox').prepend('<li class="inbox-message">'+ msg + '</li>');
            // Function to clear messages (need to refresh firebase after delete)
            $('.inbox-message').on('click', function (){
              $(this).remove();
            });
          });
        });

       

      // End document.ready
			});

    
  </script>
	
</body>

</html>
